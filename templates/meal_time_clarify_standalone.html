<!-- Standalone meal time clarification for chat - no base.html -->
<div class="message user">
    <div class="message-bubble user-bubble">{{ original_sentence }}</div>
</div>

<div class="message bot info">
    {% if icon %}
    <span class="message-icon">{{ icon }}</span>
    {% endif %}
    <div class="message-bubble">
        <h3>{{ title }}</h3>
        <p>{{ error_message }}</p>
        
        {% if meals_to_avoid %}
        <div class="event-details">
            <strong>You mentioned avoiding:</strong><br>
            {% for meal in meals_to_avoid %}
            â€¢ {{ meal }}<br>
            {% endfor %}
        </div>
        {% endif %}
        
        {% if meal_options %}
        <div class="examples-section">
            <h4>Choose a time (before or after meal time):</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                {% for option in meal_options %}
                <button type="button" 
                        class="quick-action-btn meal-option"
                        onclick="selectMealTime('{{ option.time }}')">
                    {{ option.label }}
                </button>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <div class="examples-section">
            <h4>Or specify a clear time:</h4>
            <ul>
                <li><code>tomorrow at 10:00 AM</code></li>
                <li><code>next Monday at 2:30 PM</code></li>
            </ul>
        </div>
        
        <div style="margin-top: 15px;">
            <form action="/nlp_create" method="POST" style="display: flex; gap: 10px;">
                <input type="text" id="meal_time_input" name="sentence" placeholder="Enter a clear time..." style="flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 8px;" value="{{ original_sentence }}">
                <button type="submit" class="quick-action-btn" style="background: #4285f4; color: white; border: none;">Send</button>
                {% if drive_file_id %}
                <input type="hidden" name="drive_file_id" value="{{ drive_file_id }}">
                <input type="hidden" name="drive_file_name" value="{{ drive_file_name }}">
                <input type="hidden" name="drive_file_url" value="{{ drive_file_url }}">
                {% endif %}
            </form>
        </div>
        
        <div class="quick-actions">
            <button class="quick-action-btn" onclick="window.location.href='/'">Start Over</button>
        </div>
    </div>
</div>

<script>
function selectMealTime(time) {
    var input = document.getElementById('meal_time_input');
    var original = '{{ original_sentence }}';
    
    var newSentence = original.replace(/\bavoid\s+(?:the\s+)?(?:breakfast|lunch|dinner|brunch|snack)\s*(?:time)?\b/gi, '')
                              .replace(/\b(no|not|skip)\s+(?:the\s+)?(?:breakfast|lunch|dinner|brunch|snack)\b/gi, '')
                              .trim();
    
    newSentence = newSentence + ' at ' + time;
    newSentence = newSentence.replace(/\s+/g, ' ').trim();
    
    input.value = newSentence;
    input.focus();
}
</script>
